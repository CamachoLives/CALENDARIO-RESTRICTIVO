<div class="profile-container">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Error Message -->
  <div
    *ngIf="errorMessage"
    class="alert alert-danger alert-dismissible fade show"
    role="alert"
  >
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ errorMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <!-- Success Message -->
  <div
    *ngIf="successMessage"
    class="alert alert-success alert-dismissible fade show"
    role="alert"
  >
    <i class="fas fa-check-circle me-2"></i>
    {{ successMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="profile && !isLoading" class="row">
    <!-- Profile Header -->
    <div class="col-12">
      <div class="card profile-header">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-auto">
              <div class="profile-image-container">
                <img
                  [src]="getProfileImage()"
                  [alt]="profile.nombre"
                  class="profile-image"
                />
                <button
                  class="btn btn-sm btn-outline-primary change-image-btn"
                  (click)="updateProfileImage()"
                  title="Cambiar imagen"
                >
                  <i class="fas fa-camera"></i>
                </button>
              </div>
            </div>
            <div class="col">
              <h2 class="profile-name">{{ profile.nombre }}</h2>
              <p class="profile-email text-muted">{{ profile.email }}</p>
              <span class="badge bg-primary">{{ profile.area }}</span>
            </div>
            <div class="col-auto">
              <button
                *ngIf="!isEditing"
                class="btn btn-primary"
                (click)="startEditing()"
              >
                <i class="fas fa-edit me-2"></i>
                Editar Perfil
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Details -->
    <div class="col-12 mt-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-user me-2"></i>
            Información del Perfil
          </h5>
        </div>
        <div class="card-body">
          <!-- View Mode -->
          <div *ngIf="!isEditing">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Biografía</label>
                <p class="profile-text">
                  {{ profile.biografia || "No especificada" }}
                </p>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Área</label>
                <p class="profile-text">{{ profile.area }}</p>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Teléfono</label>
                <p class="profile-text">
                  {{ profile.telefono || "No especificado" }}
                </p>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Ubicación</label>
                <p class="profile-text">
                  {{ profile.ubicacion || "No especificada" }}
                </p>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Sitio Web</label>
                <p class="profile-text">
                  <a
                    *ngIf="profile.sitio_web"
                    [href]="profile.sitio_web"
                    target="_blank"
                    class="text-decoration-none"
                  >
                    {{ profile.sitio_web }}
                    <i class="fas fa-external-link-alt ms-1"></i>
                  </a>
                  <span *ngIf="!profile.sitio_web">No especificado</span>
                </p>
              </div>
            </div>

            <!-- Social Media Links -->
            <div *ngIf="hasSocialMedia()" class="mt-4">
              <label class="form-label fw-bold">Redes Sociales</label>
              <div class="social-links">
                <a
                  *ngFor="let link of getSocialMediaLinks()"
                  [href]="link.url"
                  target="_blank"
                  class="btn btn-outline-primary me-2 mb-2"
                >
                  <i [class]="link.icon + ' me-1'"></i>
                  {{ link.name }}
                </a>
              </div>
            </div>
          </div>

          <!-- Edit Mode -->
          <form *ngIf="isEditing" (ngSubmit)="saveProfile()">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="biografia" class="form-label">Biografía</label>
                <textarea
                  id="biografia"
                  class="form-control"
                  [(ngModel)]="formData.biografia"
                  name="biografia"
                  rows="4"
                  placeholder="Cuéntanos sobre ti..."
                  maxlength="500"
                ></textarea>
                <div class="form-text">
                  {{ formData.biografia?.length || 0 }}/500 caracteres
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="area" class="form-label"
                  >Área <span class="text-danger">*</span></label
                >
                <select
                  id="area"
                  class="form-select"
                  [(ngModel)]="formData.area"
                  name="area"
                  required
                >
                  <option value="">Selecciona un área</option>
                  <option *ngFor="let area of areas" [value]="area">
                    {{ area }}
                  </option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="telefono" class="form-label">Teléfono</label>
                <input
                  type="tel"
                  id="telefono"
                  class="form-control"
                  [(ngModel)]="formData.telefono"
                  name="telefono"
                  placeholder="+1 (555) 123-4567"
                  maxlength="20"
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="ubicacion" class="form-label">Ubicación</label>
                <input
                  type="text"
                  id="ubicacion"
                  class="form-control"
                  [(ngModel)]="formData.ubicacion"
                  name="ubicacion"
                  placeholder="Ciudad, País"
                  maxlength="100"
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="sitio_web" class="form-label">Sitio Web</label>
                <input
                  type="url"
                  id="sitio_web"
                  class="form-control"
                  [(ngModel)]="formData.sitio_web"
                  name="sitio_web"
                  placeholder="https://tu-sitio-web.com"
                />
              </div>
            </div>

            <!-- Social Media Section -->
            <div class="mt-4">
              <h6 class="fw-bold">Redes Sociales</h6>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="linkedin" class="form-label">LinkedIn</label>
                  <input
                    type="url"
                    id="linkedin"
                    class="form-control"
                    [(ngModel)]="formData.redes_sociales.linkedin"
                    name="linkedin"
                    placeholder="https://linkedin.com/in/tu-perfil"
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label for="twitter" class="form-label">Twitter</label>
                  <input
                    type="url"
                    id="twitter"
                    class="form-control"
                    [(ngModel)]="formData.redes_sociales.twitter"
                    name="twitter"
                    placeholder="https://twitter.com/tu-usuario"
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label for="github" class="form-label">GitHub</label>
                  <input
                    type="url"
                    id="github"
                    class="form-control"
                    [(ngModel)]="formData.redes_sociales.github"
                    name="github"
                    placeholder="https://github.com/tu-usuario"
                  />
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="mt-4">
              <button
                type="submit"
                class="btn btn-primary me-2"
                [disabled]="!isFormValid() || isLoading"
              >
                <i class="fas fa-save me-2"></i>
                Guardar Cambios
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                (click)="cancelEditing()"
                [disabled]="isLoading"
              >
                <i class="fas fa-times me-2"></i>
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
